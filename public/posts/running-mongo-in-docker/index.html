<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Geting mongo to run in Docker was pretty straight-forward&amp;hellip; for the most part. I started with creating a new directory under the main project to keep my mongo-related stuff in, and added a Dockerfile for the mongo image. The Dockerfile is fairly simple:
FROMmongo:4.2.5MAINTAINERJacob Burley &amp;lt;j.burley@vu.nl&amp;gt;# Import init scriptADD mongo-init-opendc-db.sh /docker-entrypoint-initdb.dADD mongo-opendc-schema.sh /docker-entrypoint-initdb.dI&amp;rsquo;ve frozen the version number in order to make sure that the version stays the exact same throughout development, in order to avoid updates breaking functionality and causing a lot of debugging headaches." />
<meta name="keywords" content=", untagged" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/running-mongo-in-docker/" />


    <title>
        
            Running Mongo in Docker :: My BSc thesis Devlog  — Adding prefabs to OpenDC
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.753fac8f03736f0edc9be411eb20cee875dd7bb8e73c8155fbf6a629c863f4ca.css">






<meta itemprop="name" content="Running Mongo in Docker">
<meta itemprop="description" content="Geting mongo to run in Docker was pretty straight-forward&hellip; for the most part. I started with creating a new directory under the main project to keep my mongo-related stuff in, and added a Dockerfile for the mongo image. The Dockerfile is fairly simple:
FROMmongo:4.2.5MAINTAINERJacob Burley &lt;j.burley@vu.nl&gt;# Import init scriptADD mongo-init-opendc-db.sh /docker-entrypoint-initdb.dADD mongo-opendc-schema.sh /docker-entrypoint-initdb.dI&rsquo;ve frozen the version number in order to make sure that the version stays the exact same throughout development, in order to avoid updates breaking functionality and causing a lot of debugging headaches.">
<meta itemprop="datePublished" content="2020-04-07T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-04-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="393">
<meta itemprop="image" content="/"/>



<meta itemprop="keywords" content="untagged," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Running Mongo in Docker"/>
<meta name="twitter:description" content="Geting mongo to run in Docker was pretty straight-forward&hellip; for the most part. I started with creating a new directory under the main project to keep my mongo-related stuff in, and added a Dockerfile for the mongo image. The Dockerfile is fairly simple:
FROMmongo:4.2.5MAINTAINERJacob Burley &lt;j.burley@vu.nl&gt;# Import init scriptADD mongo-init-opendc-db.sh /docker-entrypoint-initdb.dADD mongo-opendc-schema.sh /docker-entrypoint-initdb.dI&rsquo;ve frozen the version number in order to make sure that the version stays the exact same throughout development, in order to avoid updates breaking functionality and causing a lot of debugging headaches."/>







    <meta property="article:published_time" content="2020-04-07 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">cd ~/bsc.jc0b.computer/public/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts">Devlog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>2 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="/posts/running-mongo-in-docker/">Running Mongo in Docker</a>
            </h1>

            

            <div class="post-content">
                <p>Geting mongo to run in Docker was pretty straight-forward&hellip; for the most part. I started with creating a new directory under the main project to keep my mongo-related stuff in, and added a Dockerfile for the mongo image. The Dockerfile is fairly simple:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> mongo:4.2.5</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">MAINTAINER</span><span style="color:#e6db74"> Jacob Burley &lt;j.burley@vu.nl&gt;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Import init script</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> mongo-init-opendc-db.sh /docker-entrypoint-initdb.d<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> mongo-opendc-schema.sh /docker-entrypoint-initdb.d<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>I&rsquo;ve frozen the version number in order to make sure that the version stays the exact same throughout development, in order to avoid updates breaking functionality and causing a lot of debugging headaches.</p>
<p>I&rsquo;ve also added two <code>ADD</code> lines, to add scripts to the docker-entrypoint-initdb directory on the docker host at buildtime. Every script in that folder will be run during container startup, so I plan to use them to initialize a new database, <code>opendc</code>, for storing prefab information in, as well as creating the default user and assigning access rights. These scripts currently don&rsquo;t work properly, and I&rsquo;m wondering whether it is because they are not executed in the intended order. I need to figure out what order they are executed in, but worst case I will just condense all initialization tasks into one single script.</p>
<h2 id="docker-composeyml">docker-compose.yml</h2>
<p>OpenDC uses docker-compose in order to actually build and run containers, so I need to add mongo to the <code>docker-compose.yml</code> file.
I added both mongo, as well as mongo express, as services within docker-compose. Mongo express is a web frontend for mongodb, which allows me to view databases and their contents. I added the below to <code>docker-compose.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">mongo</span>:
    <span style="color:#66d9ef">build</span>:
        <span style="color:#66d9ef">context</span>: ./mongodb
    <span style="color:#66d9ef">restart</span>: on-failure
    <span style="color:#66d9ef">environment</span>:
      <span style="color:#66d9ef">MONGO_INITDB_ROOT_USERNAME</span>: root
      <span style="color:#66d9ef">MONGO_INITDB_ROOT_PASSWORD</span>: rootpassword
      <span style="color:#66d9ef">MONGO_INITDB_DATABASE</span>: admin
      <span style="color:#66d9ef">OPENDC_DB</span>: opendc
      <span style="color:#66d9ef">OPENDC_DB_USERNAME</span>: opendc
      <span style="color:#66d9ef">OPENDC_DB_PASSWORD</span>: opendcpassword
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#ae81ff">27017</span>:<span style="color:#ae81ff">27017</span>

<span style="color:#66d9ef">mongo-express</span>:
    <span style="color:#66d9ef">image</span>: mongo-express
    <span style="color:#66d9ef">restart</span>: on-failure
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#ae81ff">8082</span>:<span style="color:#ae81ff">8081</span>
    <span style="color:#66d9ef">environment</span>:
      <span style="color:#66d9ef">ME_CONFIG_MONGODB_ADMINUSERNAME</span>: root
      <span style="color:#66d9ef">ME_CONFIG_MONGODB_ADMINPASSWORD</span>: rootpassword
</code></pre></div><p>I&rsquo;ve added some environment variables for mongo for use in the scripts added in the Dockerfile, and set the context for the mongodb build to be the folder with my Dockerfile in it. I&rsquo;m only using mongo express for testing purposes, so I&rsquo;m not really too worried about fleshing it out with its own Dockerfile and folder. Both services will restart on failure, and both have their various configuration settings pre-set.
I think it&rsquo;s probably going to be worth removing the environment variables from mongo express, because the opendc database isn&rsquo;t viewable by the root user of mongo, so mongo express isn&rsquo;t very helpful in debugging that database at the moment.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="/tags/untagged">untagged</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>393 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-04-07 02:00 &#43;0200</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    

                    
                        <span class="button next">
                            <a href="/posts/my-first-post/">
                                <span class="button__text">Hello, World!</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
            <span>Jacob Burley</span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4a69500057d68129e88f497d354afe68422eb56de6d15e45dbe2190858ea5a76bfcb096406f992984b241db45f47388ac57ab0376e3b32125bef7a8a6d0f06c4.js" integrity="sha512-SmlQAFfWgSnoj0l9NUr&#43;aEIutW3m0V5F2&#43;IZCFjqWna/ywlkBvmSmEskHbRfRziKxXqwN247MhJb73qKbQ8GxA=="></script>



    </body>
</html>
